<html>
	<head>
		<title>Detail</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="${url_prefix}/Themes/${orgTheme}/css/tips.css" type="text/css">
		<link rel="stylesheet" type="text/css" media="all" href="${url_prefix}/javascript/calendar/calendar-iflow.css" title="cal-iflow" />
		<link rel="stylesheet" type="text/css" href="${url_prefix}/javascript/yahoo/container/assets/skins/sam/container.css" />
		<link rel="stylesheet" type="text/css" href="${url_prefix}/javascript/yahoo/button/assets/skins/sam/button.css" />
		<link href="${url_prefix}/javascript/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css"/>
		<link rel="stylesheet" type="text/css" href="${url_prefix}/Themes/newflow/cssNew/main.css">

		<link rel="shortcut icon" href="images/ .ico" />
	<!--[if IE]>
		<link rel="stylesheet" href="Themes/${orgTheme}/css/iflow_ie.css" type="text/css">
	<![endif]-->

	<!--[if lt IE 7]>
		<style type="text/css">
			.icon_item { // append this style
				width:24px;
				height:24px;
			}
			img { behavior: url(iepngfix.htc) }
		</style>
	<![endif]-->

		<link type="text/css" rel="stylesheet" href="${url_prefix}/PublicFiles/default.css" />
		<script src="${url_prefix}/javascript/ajax_processing.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/tabs.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/iflow_main.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/calendar/calendar.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/calendar/lang/calendar-en_US.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/calendar/calendar-setup.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/mootools.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/FormFunctions.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/Stickman.MultiUpload.js" type="text/javascript"></script>
		<script src="${url_prefix}/javascript/jquery-1.10.2.js"></script>

	</head>
	
	<body>
	<style type="text/css">
		body {
			background: white;
		}
	</style>
		<div class="header_processo">
			<form name="user_proc_print" method="POST" action="$response.encodeURL(${url_prefix},'UserProcPrint')" target="_blank">
				<input type="hidden" name="flowid" value="$procFlowid">
				<input type="hidden" name="pid" value="$procPid">
				<input type="hidden" name="subpid" value="$procSubpid">				
			</form>
			<form action="form.jsp" id="dados" name="dados" method="POST" onsubmit="">
			#foreach($varName in $hmHidden.keySet())
				<input type="hidden" name="$varName" id="$varName" value="$hmHidden.get($varName)" />
			#end				
			<input type="hidden" name="procPreview" id="procPreview" value="true">
        <div class="title_cont" > Dados do processo n&ordm; $procPid (Pr&eacute;-visualiza&Ccedil;&atilde;o)</div>
        <div class="panel-body">
          <div class="form-horizontal" role="form">

			<!--div class="table"-->
			#if ($processDetail.isEmpty())
					<div class="alert alert-warning">
						$noDetail
					</div>
			#else
				#if (!$error.isEmpty())
					<div class="alert alert-warning">
						$error
					</div>
				#end
				#if ($procFlowid == 159)
					#set($varName="Área")
					#set($value = "")
					#if ($processDetail.get(${varName})!="")
						#set($value = $processDetail.get(${varName}))
					#end
					<input type="hidden" name="$processVarnames.get(${varName})" value="${value}">
					<div class="form-group">
						<label  class="col-sm-2 control-label" style=" font-size: 12px; margin-bottom: 2px">${varName}: </label>
						<div class="col-sm-8" style=" font-size: 12px; margin-top: 7px"> 
							#if ($processDetail.get(${varName})!="")
								$processDetail.get(${varName})
							#end 
						</div>
					</div>
					#set($varName="Subárea")
					#set($value = "")
					#if ($processDetail.get(${varName})!="")
						#set($value = $processDetail.get(${varName}))
					#end
					<input type="hidden" name="$processVarnames.get(${varName})" value="${value}">
					<div class="form-group">
						<label  class="col-sm-2 control-label">${varName}: </label>
						<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
							#if ($processDetail.get(${varName})!="")
								$processDetail.get(${varName})
							#end 
						</div>
					</div>						
					#set($varName="Assunto")
					#set($value = "")
					#if ($processDetail.get(${varName})!="")
						#set($value = $processDetail.get(${varName}))
					#end
					<input type="hidden" name="$processVarnames.get(${varName})" value="${value}">
					<div class="form-group">
						<label  class="col-sm-2 control-label">${varName}: </label>
						<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
							#if ($processDetail.get(${varName})!="")
								$processDetail.get(${varName})
							#end 
						</div>
					</div>	
					#set($varName="Nome do Cliente Municipal")
					#set($value = "")
					#if ($processDetail.get(${varName})!="")
						#set($value = $processDetail.get(${varName}))
					#end
					<input type="hidden" name="$processVarnames.get(${varName})" value="${value}">
					<div class="form-group">
						<label  class="col-sm-2 control-label">${varName}: </label>
						<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
							#if ($processDetail.get(${varName})!="")
								$processDetail.get(${varName})
							#end 
						</div>
					</div>	
					#set($varName="NIF")
					#set($value = "")
					#if ($processDetail.get(${varName})!="")
						#set($value = $processDetail.get(${varName}))
					#end
					<input type="hidden" name="$processVarnames.get(${varName})" value="${value}">
					<div class="form-group">
						<label  class="col-sm-2 control-label">${varName}: </label>
						<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
							#if ($processDetail.get(${varName})!="")
								$processDetail.get(${varName})
							#end 
						</div>
					</div>	
			#if ($user_name != "presidente")		
						#set($sAccoes=$processDetail.get("Acções"))
						#set($lAccoes=$sAccoes.split("] "))
						#if ($lAccoes != "")
							#set($listAccoes = [])
								#foreach($accao in $lAccoes)
									#if($accao.indexOf("<br>") > 0)
										#if ($listAccoes.add($accao.substring(0, $accao.indexOf("<br>"))))
										#end
									#end
								#end
						#set($accao1="")
						#set($accao2="")
							#foreach($accao in $listAccoes)
								#set($accao2=$accao1)
								#set($accao1=$accao)
							#end
						#end
						
						#set($sComents=$processDetail.get("Comentários"))
						#set($lComents=$sComents.split("] "))
						#if ($lComents != "")
							#set($listComents = [])
								#foreach($coment in $lComents)
									#if($coment.indexOf("<br>") >= 0)
										#if ($listComents.add($coment.substring(0, $coment.indexOf("<br>"))))
										#end
									#end
								#end
						#set($coment1="")
						#set($coment2="")
							#foreach($coment in $listComents)
								#set($coment2=$coment1)
								#set($coment1=$coment)
							#end
						#end
						
						<div class="form-group">
							<label  class="col-sm-2 control-label">Tramitação Recente: </label>
							<div class="col-sm-8">&nbsp;</div>				
						</div>						
						<div class="form-group">					
								#if ($accao1!="")
									<table class="col-sm-11" border="1" cellpadding="10%" style=" font-size: 14px; margin-top: 5px; margin-left: 15px">
										#if ($accao2!="")
											<tr>
												<td>$accao2 </td>
												<td> 
													#if ($coment2!="" && $coment2!="null")
														$coment2
													#end 
												</td>										
											</tr>
										#end
										<tr>
											<td>$accao1 </td>
											<td> 
													#if ($coment1!="" && $coment1!="null")
														$coment1
													#end 
											</td>										
										</tr>										
									</table>
								#else
									<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 

									</div>
								#end	
						</div>

					 
					#else
						
						#set($sAccoes=$processDetail.get("Acções"))
						#set($lAccoes=$sAccoes.split("] "))
						#set($countAccoes = 0)
						#if ($lAccoes != "")
							#set($listAccoes = [])
								#foreach($accao in $lAccoes)
									#if($accao.indexOf("<br>") > 0)
										#set($countAccoes = $velocityCount - 1)
										#if ($listAccoes.add($accao.substring(0, $accao.indexOf("<br>"))))
										#end
									#end
								#end
						#end
						
						#set($sComents=$processDetail.get("Comentários"))
						#set($lComents=$sComents.split("] "))
						#if ($lComents != "")
							#set($listComents = [])
								#foreach($coment in $lComents)
									#if($coment.indexOf("<br>") >= 0)
										#if ($listComents.add($coment.substring(0, $coment.indexOf("<br>"))))
										#end
									#end
								#end
						#end

						#set($sDatas=$processDetail.get("datas"))
						#set($lDatas=$sDatas.split("] "))
						#if ($lDatas != "")
							#set($listDatas = [])
								#foreach($data in $lDatas)
									#if($data.indexOf("<br>") >= 0)
										#if ($listDatas.add($data.substring(0, $data.indexOf("<br>"))))
										#end
									#end
								#end
						#end

						#set($sPessoas=$processDetail.get("pessoas"))
						#set($lPessoas=$sPessoas.split("] "))
						#if ($lPessoas != "")
							#set($listPessoas = [])
								#foreach($pessoa in $lPessoas)
									#if($pessoa.indexOf("<br>") >= 0)
										#if ($listPessoas.add($pessoa.substring(0, $pessoa.indexOf("<br>"))))
										#end
									#end
								#end
						#end

						#set($sMarcar=$processDetail.get("marcar"))
						#set($lMarcar=$sMarcar.split("] "))
						#set($countCheck = 0)
						#if ($lMarcar != "")
							#set($listMarcar = [])
								#foreach($marcar in $lMarcar)
									#if($marcar.indexOf("<br>") >= 0)
										#set($countCheck = $velocityCount - 1)
										#if ($listMarcar.add($marcar.substring(0, $marcar.indexOf("<br>"))))
										#end
									#end
								#end
						#end

						#set($range = [$countCheck..$countAccoes])
						#foreach($i in $range)
						   #if ($listMarcar.add(""))
						   #end
						#end	
	
						<div class="form-group">
							<label  class="col-sm-2 control-label">Tramitação: </label>
							<div class="col-sm-8">&nbsp;</div>				
						</div>
						<div class="form-group">					
							<table class="col-sm-11" border="1" cellpadding="10%" style=" font-size: 14px; margin-top: 5px; margin-left: 15px">
									
											#foreach ($accao in $listAccoes)
												#set($pos = $velocityCount)
												#foreach ($coment in $listComents)
													#if ($velocityCount == $pos)
														#if ($coment!="" && $coment!="null")
															#set($tool = $coment.replaceAll("</?[^>]+/?>", ""))
														#else
															#set($tool = "Sem comentário")
														#end
														
													#end
												#end
											
												<tr title="$tool">
													<td>$accao </td>

													#foreach ($data in $listDatas)
														#if ($velocityCount == $pos)
															<td>$data </td>
														#end
													#end
													
													#foreach ($pessoa in $listPessoas)
														#if ($velocityCount == $pos)
															<td>$pessoa </td>
														#end
													#end
													
													#set($pos2 = $pos - 1)
													#set($max_row = 0)
													#foreach ($marcar in $listMarcar)
													#set($max_row = $velocityCount - 1)
														#if ($velocityCount == $pos)
															<td>
															#if($marcar == 1)
																<input class="txt" type="checkbox" title="" checked="true" value="1" name="docs_assinar_seleccionados[$pos2]" checked>
															#else
																<input class="txt" type="checkbox" title="" value="1" name="docs_assinar_seleccionados[$pos2]">
															#end															
															</td>
														#end
													#end
													
												</tr>	
											#end
									
							</table>
						</div>		
						<input id="94_MAX_ROW" type="hidden" value="$max_row" name="94_MAX_ROW">
					#end
					
					#if ($user_name == "presidente" && $processDetail.get("Acções")!="" && (!($processDetail.get("Acção escolhida")!="") || $processDetail.get("Acção escolhida")=="pre_decisao" || $processDetail.get("Acção escolhida")=="parecer") )

						#set($valueName="Acção a executar")
						#set($varName="Decisão")
						#set($value = "") 
						#if ($processDetail.get(${valueName})!="")
							#set($value = $processDetail.get(${valueName}))
						#end
						#set($sValues=$processDetail.get($varName))
						#set($sTexts=$processDetail.get("Decisão Texto"))
						#set($lValues=$sValues.split("] "))
						#set($lTexts=$sTexts.split("] "))
						#if ($lTexts != "")
							#set($listTexts = [])
							#foreach($text in $lTexts)
								#if($text.indexOf("<br>") > 0)
									#if ($listTexts.add($text.substring(0, $text.indexOf("<br>"))))
									#end
								#end
							#end

							#if ($lValues != "")
								<div class="form-group">
									<label  class="col-sm-2 control-label">${varName}: </label>
									<select class="txt  form-control pull-right combobox" style="width:250px;" name="$processVarnames.get(${valueName})"
											onchange="camouflageForm();document.dados.op.value='16';jQuery('#dados').submit();" >
									#set($idx = 0)
									<option value="Opção de decisão" >Opção de decisão</option>
									#foreach($val in $lValues)
										#if($val.indexOf("<br>") > 0)
											#set($val = $val.substring(0, $val.indexOf("<br>")))

											<option value="$val" 
											#if($val == $value)
												selected= "selected"
											#end
											>$listTexts.get($idx)</option>
											#set($idx = $idx+1)
										#end
									#end
									</select>
								</div>
							#end
						#end
					#end
				#else
					#if ($procFlowid == 90)
								<div class="form-group">
									<label  class="col-sm-2 control-label">Criado por: </label>
									<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
										#if ($processDetail.get("Criado por")!="")
											$processDetail.get("Criado por")
										#end 
									</div>
								</div>
								<div class="form-group">
									<label  class="col-sm-2 control-label">Prioridade: </label>
									<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
										#if ($processDetail.get("Prioridade")!="")
											$processDetail.get("Prioridade")
										#end 
									</div>
								</div>
								<div class="form-group">
									<label  class="col-sm-2 control-label">Assunto: </label>
									<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
										#if ($processDetail.get("Assunto")!="")
											$processDetail.get("Assunto")
										#end 
									</div>
								</div>
								<div class="form-group">
									<label  class="col-sm-2 control-label">Descrição da tarefa: </label>
									<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
										#if ($processDetail.get("Descrição da tarefa")!="")
											$processDetail.get("Descrição da tarefa")
										#end 
									</div>
								</div>
								<div class="form-group">
									<label  class="col-sm-2 control-label">Comentário: </label>
									<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px">
										#if ($processDetail.get("Comentário")!="")
											$processDetail.get("Comentário")
										#end 										
									</div>
								</div>								
					#else
						#foreach($varName in $processDetail.keySet())
							#set($value = "")
							#if ($processDetail.get(${varName})!="")
								#set($value = $processDetail.get(${varName}))
							#end
							<input type="hidden" name="$processVarnames.get(${varName})" value="${value}">	
							<div class="form-group">
								<label  class="col-sm-2 control-label">${varName}: </label>
								<div class="col-sm-8" style=" font-size: 14px; margin-top: 5px"> 
									#if ($processDetail.get(${varName})!="")
										$processDetail.get(${varName})
									#end 
								</div>
							</div>
						#end
					#end
				#end
			#end
			#if($isForward)
				</div>
					<div class="form-group">
					<div class="col-sm-12" style=" font-size: 12px; margin-bottom: -10px;clear:both;"> Processo encaminhado, para utilizar deve aceder-lhe</div>
				</div>
			#else
				</div>
					<div class="form-group">
					<div class="col-sm-12" style=" font-size: 12px; margin-bottom: -10px;clear:both;"> Op&ccedil;&otilde;es dispon&iacute;veis </div>
				</div>
			#end
		    #if (!$processDetail.isEmpty())
				<fieldset class="submit">
				#foreach($button in $buttonList)
					#set($name=$button.get("name"))
					#set($id=$button.get("id"))
					#set($operation=$button.get("operation"))
					#set($tooltip=$button.get("tooltip"))
					#set($text=$button.get("text"))
					#set($buttonimagesrc=$button.get("buttonimagesrc"))
					#set($buttonimagealt=$button.get("buttonimagealt"))
					#set($hiddenfield=$button.get("hiddenfield"))
					&nbsp;

					<button type="submit" align="center" valign="center" class="btn btn-default" name="$name" value="$text" id="$id" 
						onClick="$operation;" title="&tooltip">
						$text 
					</button>
					&nbsp;
				#end
				</fieldset>
			#end
			</form>
		</div>
		</div>
	</div>
		<div id="preview" class="Preview">
			<button id="Aceder" style=" font-size: 24px; padding: 10px;" class="btn btn-default navbar-btn"
				onclick="javascript:openProcess($procFlowid, '$response.encodeURL($url_prefix,$uri)', 'flowid=$procFlowid&pid=$procPid&subpid=$procSubpid', false, 3);"> #*$act.get("runMax")*#
				Aceder
			</button>
		</div>
		<script language="JavaScript" type="text/javascript">
			var jQuery = jQuery.noConflict();
			jQuery("#dados").submit(function(e)
			{			
				var postData = jQuery(this).serializeArray();
				var formURL = jQuery(this).attr("action");
				jQuery.ajax(
				{
					url : formURL,
					type: "POST",
					data : postData,
					success:function(data, textStatus, jqXHR) {openProcess($procFlowid, '$response.encodeURL($url_prefix,$uri)', 'flowid=$procFlowid&pid=$procPid&subpid=$procSubpid', false, 3);},
					error: function(jqXHR, textStatus, errorThrown){openProcess($procFlowid, '$response.encodeURL($url_prefix,$uri)', 'flowid=$procFlowid&pid=$procPid&subpid=$procSubpid', false, 3);}
				});
			    e.preventDefault();	
			});
			
    	</script>
		</body>

</html>
